<!DOCTYPE html>
<html lang="lv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PWA Ikonu Ģenerators</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .icon-preview { display: flex; flex-wrap: wrap; gap: 20px; margin: 20px 0; }
        .icon-item { text-align: center; }
        .icon-item canvas { border: 1px solid #ddd; border-radius: 8px; }
        .icon-item span { display: block; margin-top: 5px; font-size: 12px; }
        #sourceImage { max-width: 200px; max-height: 200px; }
        .upload-area { border: 2px dashed #ccc; padding: 40px; text-align: center; margin: 20px 0; }
        .upload-area.dragover { border-color: #007cba; background-color: #f0f8ff; }
        button { background: #007cba; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #005a87; }
        .download-all { background: #28a745; }
        .download-all:hover { background: #218838; }
    </style>
</head>
<body>
    <h1>AVOTI TMS PWA Ikonu Ģenerators</h1>
    
    <div class="upload-area" id="uploadArea">
        <p>Velciet un nometiet attēlu šeit vai <input type="file" id="fileInput" accept="image/*" style="display: none;"><button onclick="document.getElementById('fileInput').click()">izvēlieties failu</button></p>
        <p><small>Ieteicams: 512x512px PNG formātā ar caurspīdīgu fonu</small></p>
    </div>
    
    <div id="previewArea" style="display: none;">
        <h3>Sākotnējais attēls:</h3>
        <img id="sourceImage" alt="Source image">
        
        <h3>Ģenerētās ikonas:</h3>
        <div class="icon-preview" id="iconPreview"></div>
        
        <button class="download-all" onclick="downloadAll()">Lejupielādēt visas ikonas (.zip)</button>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script>
        const sizes = [72, 96, 128, 144, 152, 192, 384, 512];
        let generatedIcons = {};
        
        // Upload area drag and drop
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });
        
        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });
        
        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFile(files[0]);
            }
        });
        
        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleFile(e.target.files[0]);
            }
        });
        
        function handleFile(file) {
            if (!file.type.startsWith('image/')) {
                alert('Lūdzu izvēlieties attēla failu');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = (e) => {
                const img = new Image();
                img.onload = () => {
                    generateIcons(img);
                    document.getElementById('sourceImage').src = e.target.result;
                    document.getElementById('previewArea').style.display = 'block';
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }
        
        function generateIcons(sourceImg) {
            const preview = document.getElementById('iconPreview');
            preview.innerHTML = '';
            generatedIcons = {};
            
            sizes.forEach(size => {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                
                canvas.width = size;
                canvas.height = size;
                
                // Draw with antialiasing
                ctx.imageSmoothingEnabled = true;
                ctx.imageSmoothingQuality = 'high';
                
                // Add slight padding and center the image
                const padding = size * 0.1;
                const drawSize = size - (padding * 2);
                ctx.drawImage(sourceImg, padding, padding, drawSize, drawSize);
                
                // Store canvas data
                generatedIcons[size] = canvas.toDataURL('image/png');
                
                // Create preview
                const iconItem = document.createElement('div');
                iconItem.className = 'icon-item';
                
                const previewCanvas = canvas.cloneNode();
                const previewCtx = previewCanvas.getContext('2d');
                previewCtx.drawImage(canvas, 0, 0);
                
                const label = document.createElement('span');
                label.textContent = `${size}x${size}`;
                
                const downloadBtn = document.createElement('button');
                downloadBtn.textContent = 'Lejupielādēt';
                downloadBtn.style.marginTop = '5px';
                downloadBtn.style.fontSize = '10px';
                downloadBtn.style.padding = '3px 6px';
                downloadBtn.onclick = () => downloadIcon(size);
                
                iconItem.appendChild(previewCanvas);
                iconItem.appendChild(label);
                iconItem.appendChild(downloadBtn);
                preview.appendChild(iconItem);
            });
        }
        
        function downloadIcon(size) {
            const link = document.createElement('a');
            link.download = `icon-${size}x${size}.png`;
            link.href = generatedIcons[size];
            link.click();
        }
        
        async function downloadAll() {
            const zip = new JSZip();
            const folder = zip.folder('avoti-tms-icons');
            
            // Add all icons to zip
            Object.entries(generatedIcons).forEach(([size, dataUrl]) => {
                const base64 = dataUrl.split(',')[1];
                folder.file(`icon-${size}x${size}.png`, base64, {base64: true});
            });
            
            // Generate zip and download
            const content = await zip.generateAsync({type: 'blob'});
            const link = document.createElement('a');
            link.href = URL.createObjectURL(content);
            link.download = 'avoti-tms-icons.zip';
            link.click();
        }
    </script>
</body>
</html>